events {
    worker_connections 1024;
}

http {
    log_format json_logs escape=json
        '{'
        '"timestamp":"$time_iso8601",'
        '"remote_addr":"$remote_addr",'
        '"method":"$request_method",'
        '"uri":"$request_uri",'
        '"status":$status,'
        '"body_bytes":$body_bytes_sent,'
        '"request_time":$request_time,'
        '"user_agent":"$http_user_agent",'
        '"service":"kong-logs"'
        '}';

    server {
        listen 80;
        
        # Kong health logs endpoint
        location /health-logs {
            access_log /var/log/nginx/health.log json_logs;
            return 200 '{"status":"logged"}';
            add_header Content-Type application/json;
        }

        # General logs endpoint  
        location /logs {
            access_log /var/log/nginx/access.log json_logs;
            return 200 '{"status":"logged"}';
            add_header Content-Type application/json;
        }

        # Health check for log collector itself
        location /health {
            return 200 '{"status":"healthy","service":"log-collector"}';
            add_header Content-Type application/json;
        }
    }
}